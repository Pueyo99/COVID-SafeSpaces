Index: app/src/main/java/com/example/covidsafespaces/ServerConnection.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.covidsafespaces;\r\n\r\nimport android.app.AlertDialog;\r\nimport android.content.Context;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.graphics.Color;\r\nimport android.graphics.Matrix;\r\nimport android.media.ExifInterface;\r\nimport android.os.Looper;\r\nimport android.provider.SyncStateContract;\r\nimport android.util.Base64;\r\nimport android.util.Log;\r\nimport android.view.Gravity;\r\nimport android.view.ViewGroup;\r\nimport android.view.Window;\r\nimport android.view.WindowManager;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.ProgressBar;\r\nimport android.widget.TextView;\r\n\r\nimport org.jetbrains.annotations.NotNull;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.DataOutputStream;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.io.OutputStream;\r\nimport java.io.OutputStreamWriter;\r\nimport java.net.HttpURLConnection;\r\nimport java.net.MalformedURLException;\r\nimport java.net.URL;\r\n\r\nimport okhttp3.Call;\r\nimport okhttp3.Callback;\r\nimport okhttp3.MediaType;\r\nimport okhttp3.OkHttpClient;\r\nimport okhttp3.Request;\r\nimport okhttp3.RequestBody;\r\nimport okhttp3.Response;\r\n\r\n\r\npublic class ServerConnection {\r\n    //private final String serverURL = \"http://paeaccenture.pagekite.me/\";\r\n    //private final String serverURL = \"http://98972deb0cc1.eu.ngrok.io/\";\r\n    //private final String serverURL = \"http://192.168.1.202:5000/\";\r\n    private final String serverURL = \"http://147.83.50.15:5902/\";\r\n\r\n\r\n    public void postImage(final byte[] image, final String filename, final int rotation){\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                OkHttpClient client = new OkHttpClient();\r\n\r\n                JSONObject data = new JSONObject();\r\n                try {\r\n                    data.put(\"image\",Base64.encodeToString(image, Base64.DEFAULT));\r\n                    data.put(\"filename\", filename);\r\n                    data.put(\"rotation\", rotation);\r\n                } catch (JSONException e) {\r\n                    e.printStackTrace();\r\n                }\r\n\r\n                RequestBody body = RequestBody.create(data.toString(),MediaType.parse(\"application/json\"));\r\n                Request request = new Request.Builder().url(serverURL+\"image\").post(body).build();\r\n\r\n                client.newCall(request).enqueue(new Callback() {\r\n                    @Override\r\n                    public void onFailure(@NotNull Call call, @NotNull IOException e) {\r\n                        call.cancel();\r\n                        Log.i(\"prueba\", e.toString());\r\n                        Log.i(\"prueba\", \"Ha fallado la conexión\");\r\n                    }\r\n\r\n                    @Override\r\n                    public void onResponse(@NotNull Call call, @NotNull Response response) throws IOException {\r\n                        //Log.i(\"prueba\", response.body().string());\r\n                        Log.i(\"prueba\", \"Imagen guardada en el servidor\");\r\n                    }\r\n                });\r\n            }\r\n        }).start();\r\n    }\r\n\r\n    public void getCapacity(final String capacity, final Listener listener){\r\n\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                OkHttpClient client = new OkHttpClient();\r\n                Request request = new Request.Builder().url(serverURL+capacity).get().build();\r\n\r\n                client.newCall(request).enqueue(new Callback() {\r\n                    @Override\r\n                    public void onFailure(@NotNull Call call, @NotNull IOException e) {\r\n                        call.cancel();\r\n                        Log.i(\"prueba\", \"Ha fallado la conexión\");\r\n                    }\r\n\r\n                    @Override\r\n                    public void onResponse(@NotNull Call call, @NotNull Response response) throws IOException {\r\n                        String data = response.body().string();\r\n                        Log.i(\"prueba\", data);\r\n                        try {\r\n                            listener.receiveMessage(new JSONObject(data));\r\n                        } catch (JSONException e) {\r\n                            e.printStackTrace();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }).start();\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/covidsafespaces/ServerConnection.java	(revision 89879df84c210c3975a5b61ecb84fb5f1ba813bb)
+++ app/src/main/java/com/example/covidsafespaces/ServerConnection.java	(date 1603364173677)
@@ -47,7 +47,7 @@
     //private final String serverURL = "http://paeaccenture.pagekite.me/";
     //private final String serverURL = "http://98972deb0cc1.eu.ngrok.io/";
     //private final String serverURL = "http://192.168.1.202:5000/";
-    private final String serverURL = "http://147.83.50.15:5902/";
+    private final String serverURL = "http://147.83.50.15:8999/";
 
 
     public void postImage(final byte[] image, final String filename, final int rotation){
Index: ../api/app.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from flask import Flask, jsonify, request\r\nfrom PIL import Image\r\nimport base64\r\nfrom io import BytesIO\r\nimport datetime\r\nimport time\r\n\r\nSQR_M_PERSON = 4.0\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route('/<float:room_dim>', methods = ['GET'])\r\ndef max_cap(room_dim):\r\n\r\n    max_capacity = int(room_dim / SQR_M_PERSON)\r\n    time.sleep(3)\r\n    return jsonify(\r\n\r\n        {'max_cap': max_capacity}\r\n\r\n        )\r\n\r\n\r\n@app.route('/image', methods = ['POST'])\r\ndef read_image():\r\n\tjson = request.json\r\n\tcontent = base64.b64decode(json['image'])\r\n\tfilename = json['filename']\r\n\trotation = json['rotation']\r\n\tprint(rotation)\r\n\timage = Image.open(BytesIO(content)).rotate((rotation*90 -90), expand=True)\r\n\timage.save(\"images/\"+filename+\".jpeg\")\r\n\treturn jsonify({'prueba':'Imagen guardada'})\r\n\r\n\r\nif __name__ == '__main__':\r\n    app.run(debug=True, host='0.0.0.0')\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- ../api/app.py	(revision 89879df84c210c3975a5b61ecb84fb5f1ba813bb)
+++ ../api/app.py	(date 1603376067269)
@@ -4,6 +4,7 @@
 from io import BytesIO
 import datetime
 import time
+import database
 
 SQR_M_PERSON = 4.0
 
@@ -14,11 +15,18 @@
 
     max_capacity = int(room_dim / SQR_M_PERSON)
     time.sleep(3)
-    return jsonify(
+    return jsonify({'max_cap': max_capacity})
 
-        {'max_cap': max_capacity}
-
-        )
+@app.route('/<string:username>', methods = ['GET'])
+def login(username):
+	if(username != "favicon.ico"):
+		db = database.Database()
+		password = db.selectUser(username)
+		db.close()
+		print(password)
+		return jsonify({'password':password})
+	else:
+		return jsonify({'error':'xapa pesao'})
 
 
 @app.route('/image', methods = ['POST'])
@@ -32,6 +40,15 @@
 	image.save("images/"+filename+".jpeg")
 	return jsonify({'prueba':'Imagen guardada'})
 
+@app.route('/register', methods = ['POST'])
+def register_user():
+	json = request.json
+	username = json['username']
+	password = json['password']
+	db = database.Database()
+	db.registerUser(username, password)
+	db.close()
+	return jsonify({'register':'successful registration'})
 
 if __name__ == '__main__':
     app.run(debug=True, host='0.0.0.0')
